"use strict";function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(i,t){for(var e=0;e<t.length;e++){var o=t[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(i,o.key,o)}}function _createClass(i,t,e){return t&&_defineProperties(i.prototype,t),e&&_defineProperties(i,e),i}var vector=require("../../../lib/vector.js"),config=require("../../../lib/config.js"),utils=require("../../../lib/utils.js"),closeObjects=[],Matter=require("matter-js"),Body=Matter.Body,Player=function(){function e(i,t){_classCallCheck(this,e),this.id=i,this.body=t,this.position=vector(this.body.position),this.velocity=vector(),this.angle=this.body.angle,this.radius=config.player.radius,this.mouse=vector(),this.lastShoot=Date.now(),this.movingX=!1,this.movingY=!1,this.label="player",this.health=100}return _createClass(e,[{key:"addToQuadtree",value:function(i){i.insert({x:this.body.position.x-this.radius,y:this.body.position.y-this.radius,width:2*this.radius,height:2*this.radius,self:this})}},{key:"update",value:function(i){closeObjects=i.quadtree.retrieve({x:this.body.position.x-this.radius,y:this.body.position.y-this.radius,width:2*this.radius,height:2*this.radius}),Body.applyForce(this.body,this.body.position,{x:this.velocity.x,y:this.velocity.y}),this.velocity.limit(config.player.speed),this.movingX||(this.velocity.x=utils.lerp(this.velocity.x,0,.4)),this.movingY||(this.velocity.y=utils.lerp(this.velocity.y,0,.4)),this.position.set(this.body.position),this.movingX=!1,this.movingY=!1}},{key:"handleBulletCollision",value:function(){for(var i=0;i<closeObjects.length;i++){var t=closeObjects[i].self;"bullet"===t.label&&this.id!==t.playerId&&this.position.dist(t.position)<=this.radius+t.radius&&(this.health-=2)}}},{key:"setMouse",value:function(i,t){this.mouse.set(i,t)}},{key:"moveUp",value:function(){this.velocity.y-=config.player.acceleration,this.movingY=!0}},{key:"moveRight",value:function(){this.velocity.x-=config.player.acceleration,this.movingX=!0}},{key:"moveDown",value:function(){this.velocity.y+=config.player.acceleration,this.movingY=!0}},{key:"moveLeft",value:function(){this.velocity.x+=config.player.acceleration,this.movingX=!0}},{key:"shoot",value:function(i){var t;20<Date.now()-this.lastShoot&&(t=this.position.heading(this.mouse),i.addBullet(this.id,{position:vector({x:this.position.x+22*Math.cos(t+.17),y:this.position.y+22*Math.sin(t+.17)}),angle:t}),this.lastShoot=Date.now())}}]),e}();module.exports={create:function(i,t){return new Player(i,t)}};