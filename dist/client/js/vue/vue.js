"use strict";function _createForOfIteratorHelper(e,n){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=_unsupportedIterableToArray(e))||n&&e&&"number"==typeof e.length){o&&(e=o);var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,a=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return i=e.done,e},e:function(e){a=!0,r=e},f:function(){try{i||null==o.return||o.return()}finally{if(a)throw r}}}}function _unsupportedIterableToArray(e,n){if(e){if("string"==typeof e)return _arrayLikeToArray(e,n);var o=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(o="Object"===o&&e.constructor?e.constructor.name:o)||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(e,n):void 0}}function _arrayLikeToArray(e,n){(null==n||n>e.length)&&(n=e.length);for(var o=0,t=new Array(n);o<n;o++)t[o]=e[o];return t}var client=require("./../client.js"),config=require("../../../../lib/config.js"),utils=require("./utils.js"),loginApp=require("./login.js"),registerApp=require("./register.js"),lobbyApp=require("./lobby.js"),roomApp=require("./room.js"),dialogApp=require("./dialog.js"),overlay=require("./overlay.js"),loadApp=require("./load.js"),setCodename=!1;client.socket.on("client:room:enter",function(){overlay.hidden=!0,utils.showApp(""),utils.showGame()}),client.socket.on("room:delete",function(e){e=document.querySelector("[data-id='".concat(e,"']"));e&&e.remove()}),client.socket.on("client:lobby:room:update",function(e){var n,o=[],t=_createForOfIteratorHelper(document.querySelectorAll(".roomWrapper"));try{for(t.s();!(n=t.n()).done;){var r=n.value;o.push(r.dataset.id)}}catch(e){t.e(e)}finally{t.f()}if(o.includes(e.id)){var i,a=_createForOfIteratorHelper(document.querySelector("[data-id='".concat(e.id,"']")).children);try{for(a.s();!(i=a.n()).done;){var l=i.value;"number"==l.dataset.colname?l.getElementsByTagName("p")[0].innerText=e.index:"description"==l.dataset.colname?l.getElementsByTagName("p")[0].innerText=e.description:"wave"==l.dataset.colname?l.getElementsByTagName("p")[0].innerText="".concat(e.currentWave,"/").concat(e.maxWave):"players"==l.dataset.colname&&(l.getElementsByTagName("p")[0].innerText="".concat(e.players.length,"/").concat(config.maxPlayers))}}catch(e){a.e(e)}finally{a.f()}}else utils.addRoom(e)}),client.socket.on("client:join",function(e){client.join(e)}),client.socket.on("message:lobby",function(e,n){utils.createLobbyMessage(e,n)}),client.socket.on("client:register:error",function(e){"duplicate"==e&&(registerApp.usernameError=!0,registerApp.usernameMessage=config.warnMessages.taken)}),client.socket.on("client:register:success",function(e,n){registerApp.login(),client.register(e,n)}),client.socket.on("client:login:error",function(e){"unknown"==e?document.getElementById("username").value.length&&(loginApp.usernameError=!0,loginApp.usernameMessage=config.warnMessages.unknown,loginApp.passwordError=!1):"incorrect"==e&&document.getElementById("password").value.length&&(loginApp.passwordError=!0,loginApp.passwordMessage=config.warnMessages.incorrectPassword)}),client.socket.on("client:login:success",function(e){utils.showApp(loadApp),client.login(e)}),client.socket.on("client:codename:error",function(e){"duplicate"==e&&dialogApp.showError("This name is already taken")}),client.socket.on("client:codename:success",function(e){dialogApp.errorHidden=!0,dialogApp.error="",setCodename&&(client.setCodename(e),client.codename=e,dialogApp.hide())}),client.socket.on("client:load",function(e){utils.showApp(lobbyApp);for(var n,o=0,t=Object.keys(e);o<t.length;o++){var r=t[o];client[r]=e[r]}""===client.codename&&(n=function(e,n){dialogApp.errorHidden=!0,dialogApp.error="",e.length<4&&dialogApp.showError("That's too short"),e.length||dialogApp.showError("This field is required"),!e.length||e.length<4||client.validateCodename(e)},dialogApp.show({title:"Name",description:"What would you like others to call you?",proceedText:"Continue",cancelText:"Check",inputHidden:!1,cancelHidden:!1,proceedFunction:function(){var e=document.getElementById("dialogInput").value;n(e),setCodename=!0},cancelFunction:function(){setCodename=!1;var e=document.getElementById("dialogInput").value;n(e)}})),sessionStorage.setItem(config.sessionKey,e.id),console.log(client)}),window.onload=function(){sessionStorage[config.sessionKey]?client.login(sessionStorage[config.sessionKey]):(utils.showApp(loginApp),console.log("Session has expired. Please login again"))};